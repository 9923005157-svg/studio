{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system, storing their role.",
      "properties": {
        "role": {
          "type": "string",
          "description": "The role of the user within the application.",
          "enum": [
            "Manufacturer",
            "Distributor",
            "Pharmacy",
            "FDA",
            "Patient"
          ]
        }
      },
      "required": [
        "role"
      ]
    },
    "Manufacturer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Manufacturer",
      "type": "object",
      "description": "Represents a pharmaceutical manufacturer in the PharmaTrust system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the manufacturer entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the manufacturing company."
        },
        "address": {
          "type": "string",
          "description": "Physical address of the manufacturing facility."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address for contacting the manufacturer",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "contactEmail"
      ]
    },
    "Distributor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Distributor",
      "type": "object",
      "description": "Represents a pharmaceutical distributor in the PharmaTrust system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the distributor entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the distribution company."
        },
        "address": {
          "type": "string",
          "description": "Physical address of the distribution center."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address for contacting the distributor",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "contactEmail"
      ]
    },
    "Pharmacy": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pharmacy",
      "type": "object",
      "description": "Represents a pharmacy in the PharmaTrust system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pharmacy entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the pharmacy."
        },
        "address": {
          "type": "string",
          "description": "Physical address of the pharmacy."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address for contacting the pharmacy",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "contactEmail"
      ]
    },
    "Patient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patient",
      "type": "object",
      "description": "Represents a patient in the PharmaTrust system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the patient entity."
        },
        "name": {
          "type": "string",
          "description": "Full name of the patient."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "Date of birth of the patient.",
          "format": "date"
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address for contacting the patient",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "dateOfBirth",
        "contactEmail"
      ]
    },
    "FDAApproval": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FDAApproval",
      "type": "object",
      "description": "Represents a request for FDA approval for a drug shipment, including batch and real-time sensor data.",
      "properties": {
        "drugName": {
          "type": "string",
          "description": "The name of the drug being submitted for approval."
        },
        "drugDetails": {
          "type": "string",
          "description": "A brief description of the drug."
        },
        "manufacturerId": {
          "type": "string",
          "description": "The UID of the manufacturer submitting the request."
        },
        "manufacturerName": {
          "type": "string",
          "description": "The name of the manufacturer."
        },
        "submissionDate": {
          "type": "string",
          "description": "The ISO 8601 date of the submission.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the approval request.",
          "enum": [
            "Pending",
            "Approved",
            "Rejected"
          ]
        },
        "shipmentStatus": {
          "type": "string",
          "description": "The current status of the shipment after FDA approval.",
          "enum": [
            "Pending Distributor Pickup",
            "Dispatching",
            "In Transit to Pharmacy",
            "Delivered to Pharmacy"
          ]
        },
        "batchNumber": {
          "type": "string",
          "description": "The batch number for the submitted drug."
        },
        "sampleCount": {
          "type": "string",
          "description": "The number of samples included in this batch."
        },
        "temperature": {
          "type": "string",
          "description": "The temperature reading at the time of submission."
        },
        "humidity": {
          "type": "string",
          "description": "The humidity reading at the time of submission."
        },
        "tamperStatus": {
          "type": "string",
          "description": "The tamper status of the container at the time of submission."
        },
        "expiryDate": {
          "type": "string",
          "description": "The expiration date of the drug batch.",
          "format": "date"
        }
      },
      "required": [
        "drugName",
        "drugDetails",
        "manufacturerId",
        "manufacturerName",
        "submissionDate",
        "status",
        "batchNumber",
        "sampleCount",
        "temperature",
        "humidity",
        "tamperStatus",
        "expiryDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection for storing user role information. Uses path-based ownership for user data. Includes userId as a parameter.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user, matching their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/manufacturers/{manufacturerId}",
        "definition": {
          "entityName": "Manufacturer",
          "schema": {
            "$ref": "#/backend/entities/Manufacturer"
          },
          "description": "Collection for storing manufacturer information. Uses path-based ownership for manufacturer data. Includes manufacturerId as a parameter.",
          "params": [
            {
              "name": "manufacturerId",
              "description": "Unique identifier for the manufacturer."
            }
          ]
        }
      },
      {
        "path": "/distributors/{distributorId}",
        "definition": {
          "entityName": "Distributor",
          "schema": {
            "$ref": "#/backend/entities/Distributor"
          },
          "description": "Collection for storing distributor information. Uses path-based ownership for distributor data. Includes distributorId as a parameter.",
          "params": [
            {
              "name": "distributorId",
              "description": "Unique identifier for the distributor."
            }
          ]
        }
      },
      {
        "path": "/pharmacies/{pharmacyId}",
        "definition": {
          "entityName": "Pharmacy",
          "schema": {
            "$ref": "#/backend/entities/Pharmacy"
          },
          "description": "Collection for storing pharmacy information. Uses path-based ownership for pharmacy data. Includes pharmacyId as a parameter.",
          "params": [
            {
              "name": "pharmacyId",
              "description": "Unique identifier for the pharmacy."
            }
          ]
        }
      },
      {
        "path": "/patients/{patientId}",
        "definition": {
          "entityName": "Patient",
          "schema": {
            "$ref": "#/backend/entities/Patient"
          },
          "description": "Collection for storing patient information. Uses path-based ownership for patient data. Includes patientId as a parameter.",
          "params": [
            {
              "name": "patientId",
              "description": "Unique identifier for the patient."
            }
          ]
        }
      },
      {
        "path": "/fda_approvals/{fdaApprovalId}",
        "definition": {
          "entityName": "FDAApproval",
          "schema": {
            "$ref": "#/backend/entities/FDAApproval"
          },
          "description": "Collection for storing FDA approval information. Denormalizes manufacturerId for efficient querying and authorization. Includes fdaApprovalId as a parameter.",
          "params": [
            {
              "name": "fdaApprovalId",
              "description": "Unique identifier for the FDA approval."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the PharmaTrust application, focusing on securing the pharmaceutical supply chain. It provides separate collections for each role (Manufacturer, Distributor, Pharmacy, Patient, and FDA) to enable role-based access control. A dedicated 'users' collection is added to store user-specific data like roles, which is crucial for authorization. The 'fda_approvals' collection allows manufacturers to submit items and FDA to approve them. This structure prioritizes Authorization Independence by avoiding hierarchical authorization dependencies, using dedicated collections for each entity and denormalizing manufacturerId within the FDAApproval collection to facilitate direct queries. This eliminates the need for `get()` calls in security rules, enabling atomic operations and improving debuggability. Structural Segregation is achieved by creating distinct collections for each entity, ensuring a homogeneous security posture within each collection. QAPs are supported through this segregation, allowing secure `list` operations based on user roles."
  }
}
